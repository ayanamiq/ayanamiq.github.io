<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta name="description" content="一晃而过的时间，都做了些什么">
<meta name="keywords" content="JAVA">
<meta property="og:type" content="website">
<meta property="og:title" content="王靖尧的博客">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="王靖尧的博客">
<meta property="og:description" content="一晃而过的时间，都做了些什么">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="王靖尧的博客">
<meta name="twitter:description" content="一晃而过的时间，都做了些什么">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/2/">





  <title>王靖尧的博客</title>
  








</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">王靖尧的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-schedule">
          <a href="/schedule/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-calendar"></i> <br>
            
            日程表
          </a>
        </li>
      
        
        <li class="menu-item menu-item-sitemap">
          <a href="/sitemap.xml" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br>
            
            站点地图
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/12/06/mysql基础/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="王靖尧">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="王靖尧的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/06/mysql基础/" itemprop="url">mysql基础</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-12-06T18:12:58+08:00">
                2018-12-06
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>MySQL数据库</p>
<h3 id="1-增删改查"><a href="#1-增删改查" class="headerlink" title="1.增删改查"></a>1.增删改查</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">插入(增)：</span><br><span class="line">insert into 表名字(列名1，列名2...) values(值1，值2...)</span><br><span class="line">或者：</span><br><span class="line">insert into 表名字 values(值1，值2...)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">删除(删)：</span><br><span class="line">delete from 表名字</span><br><span class="line">如果不加where条件，则删除数据表中所有数据</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">修改：</span><br><span class="line">update 表名字 set 列1=值1，列2=值2...</span><br><span class="line">如果不加where条件，则更新数据表中所有数据</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">查询：</span><br><span class="line">select * from 表名字</span><br><span class="line">星号代表查询数据表中所有字段</span><br><span class="line">select id,stu_name,age, from 表名字</span><br><span class="line">查询多个字段，用逗号进行分割</span><br></pre></td></tr></table></figure>
<p>常用数据类型<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">int 整形</span><br><span class="line">double 浮点型</span><br><span class="line">datetime 日期型</span><br><span class="line">varchar 字符型(要给长度，如20，即20个字符)</span><br><span class="line">```	</span><br><span class="line"></span><br><span class="line">1.创建数据库:</span><br><span class="line">`create database[if not exists] db_name`</span><br><span class="line"></span><br><span class="line">2.删除数据库:</span><br><span class="line">`drop database[if exists] db_name`</span><br><span class="line"></span><br><span class="line">3.创建数据表:</span><br></pre></td></tr></table></figure></p>
<p>create table[if not exists] table_name(<br>    列名 类型 是否为空<br>    列名 类型 是否为空<br>)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### 2.主外键</span><br><span class="line">主键：primary_key</span><br><span class="line">	1.保证数据唯一性</span><br><span class="line">	2.一个数据表只能有一个主键</span><br><span class="line">	3.主键不可以为空，并且不可以重复</span><br><span class="line">	</span><br><span class="line">  外键:</span><br><span class="line">	1.保证数据的完整性，一致性</span><br><span class="line">	2.外键列和参照列的数据类型必须一致</span><br><span class="line">	3.参照列的表为父表，外键列的表为子表</span><br><span class="line">	4.实现一对多，多对一的关系</span><br><span class="line">	5.外键列和参照列必须创建索引，如不创建，mySQL会自动创建</span><br></pre></td></tr></table></figure></p>
<p>create table test(<br>    id int primary_key auto_increment,<br>    foreign key(test1_id) references  test2(id)<br>    //外键列为test1_id(当前表的列),参照了test2表的id列<br>)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">尽量不要使用外键。</span><br><span class="line"></span><br><span class="line">## 3.修改表sql</span><br><span class="line">修改数据表</span><br></pre></td></tr></table></figure></p>
<p>ALTER TABLE &lt;表名&gt;<br>[ALTER COLUMN &lt;列名&gt; &lt;新数据类型&gt;]<br>|[ADD &lt;列名&gt; &lt;数据类型&gt; [属性]<br>|[DROP COLUMN &lt;列名&gt;]<br>|[ADD [constraint] [约束名] 约束定义<br>|[DROP [constraint] 约束名]<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">```</span><br><span class="line">create table test(</span><br><span class="line">	id int PRIMARY key auto_increment, //创建id列，规定为主键列，自增</span><br><span class="line">	test_name varchar(20),</span><br><span class="line">	test2_id int</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p>
<p>新增字段<br><code>alter table wd_user add account_status varchar(255) not null default 0;</code></p>
<p>修改字段<br><code>ALTER TABLE wd_evaluate MODIFY cus_id VARCHAR(200) NULL DEFAULT null COMMENT &#39;定制表id&#39;;</code></p>
<p>查看表结构<br><code>desc tabl_name;</code></p>
<h3 id="4-where条件"><a href="#4-where条件" class="headerlink" title="4.where条件"></a>4.where条件</h3><p>可以跟在select/update/delete后<br>多个where条件，并且的关系，用and链接，或者的关系，用or链接</p>
<p>group by:把查询结构进行分组，分组结果可以升序(asc)或降序(desc),默认升序,用于去重</p>
<p>having:如果要将group by的结果进行删选，需要用到having关键字，不可以用where</p>
<p>order by:把查询结果进行排序，可升(asc)可降(desc),默认升序，可以进行多次排序，用逗号分割排序字段</p>
<p>limit:限制查询返回的结果(用于分页功能)是select语句的最后一个关键字<br>    参数1：从第几条结果开始获取<br>    参数2：获取几条结果</p>
<p>select语句结构：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">select * from 表名字</span><br><span class="line">	where</span><br><span class="line">	 gruop by</span><br><span class="line">	  having</span><br><span class="line">	   order by</span><br><span class="line">	    limit</span><br></pre></td></tr></table></figure></p>
<p>关键字顺序不可以颠倒</p>
<h3 id="5-字符函数"><a href="#5-字符函数" class="headerlink" title="5.字符函数"></a>5.字符函数</h3><p> 以下字符函数都必须跟在select语句后面<br><code>concat(str1,str2,...)：拼接字符串</code></p>
<p><code>left(str,1):左侧开始截取字符串，参数2为截取几位</code></p>
<p><code>right(str,1):右侧开始截取，参数2位截取几位</code></p>
<p><code>substring(参数1，参数2，参数3):1.要截取的字符串2.从第几位开始截取3.截取的长度</code></p>
<p><code>replace(参数1，参数2，参数3):1.要处理的字符串2.要替换的字符3.替换成什么</code></p>
<p><code>trim(str):去除字符串前后的空格</code></p>
<p><code>length(str):字符串长度</code></p>
<p><code>lower(str):字符串转小写</code></p>
<p><code>upper(str):字符串转大写</code></p>
<p>问题：<br>已知一个数字字段，内容不规律，最长有10位，最短有4位，<br>想把不够10位的全部在前边用0补齐，怎么办?</p>
<p>SQL：<br>update 表名字 set num = right(concat(‘000000’,num),10);<br>解:因为最短有4位，在每个字符串左侧都拼接6个0，然后从右侧开始截取10个字符</p>
<h3 id="6-聚合函数"><a href="#6-聚合函数" class="headerlink" title="6.聚合函数"></a>6.聚合函数</h3><p>聚合函数必须跟在select语句后面<br><code>一列的和：select sum(列名) from 表名 where ...条件</code></p>
<p><code>一列的最大值：select max(列名) from 表名 where ...条件</code></p>
<p><code>一列的最小值：select min(列名) from 表名 where ...条件</code></p>
<p><code>一列的数量：select count(列名/一般都用id) from 表名 where ...条件</code></p>
<p><code>一列的平均值：select avg(列名) from 表名 where ...条件</code></p>
<h3 id="7-case-when"><a href="#7-case-when" class="headerlink" title="7. case when"></a>7. case when</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">select case(</span><br><span class="line">	when sex=&apos;0&apos; then &apos;女&apos;</span><br><span class="line">	when sex=&apos;1&apos; then &apos;男&apos;</span><br><span class="line">	end</span><br><span class="line">)</span><br><span class="line">from 表名</span><br></pre></td></tr></table></figure>
<p>case when方法，该方法用于查询时替换表中数据，<br>如性别字段，里面有0和1，<br>查询时可分别把0和1替换成女和男</p>
<h3 id="8-like-模糊查询"><a href="#8-like-模糊查询" class="headerlink" title="8.like(模糊查询)"></a>8.like(模糊查询)</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">select * from student where stu_name like &apos;%小%&apos;;</span><br><span class="line">%表示可随意替换</span><br><span class="line">小%  表示必须以小开头，后边随意</span><br><span class="line">%小  表示必须以小结尾，前边随意</span><br><span class="line">%小% 表示前后都随意，中间包含小</span><br></pre></td></tr></table></figure>
<h3 id="9-数值函数"><a href="#9-数值函数" class="headerlink" title="9.数值函数"></a>9.数值函数</h3><pre><code>ceil():向上取整
floor():向下取整
round():四舍五入
power():幂运算
</code></pre><p>以下方法必须跟在where关键字后面，作为where的修饰<br>[not] between … and …<br>区间范围，属于where关键字,可用大于号和小于号来实现相同的功能</p>
<p>[not] in(1,2,3,4,5)<br>判断一个字段的值是否与括号内的值相同，<br>括号内是or的关系，即满足任何一个条件，都会显示出来</p>
<p>is [not] null:判断字段是否为空</p>
<h3 id="10-时间函数"><a href="#10-时间函数" class="headerlink" title="10..时间函数"></a>10..时间函数</h3><p>now()：当前时间(年月日  时分秒)</p>
<p>curdate()：当前日期(年月日)</p>
<p>curtime()：当前时间(时分秒)</p>
<p>date_add：日期加减算法<br>参数1：要进行运算的日期<br>参数2：加或减的量<br>参数3：加或减的日期单位(小时，天，周，月，年)</p>
<p>datediff()：日期差值计算<br>参数1：日期类型<br>参数2：日期类型</p>
<p>date_format():日期格式化<br>将指定日期，安装指定规则进行格式化(具体请百度该函数)<br>date_format(‘2017-1-1’,’%y/%m/%d/‘)—&gt;2017/1/1</p>
<h3 id="11-表连接"><a href="#11-表连接" class="headerlink" title="11.表连接"></a>11.表连接</h3><p>1.查询结果在哪个表<br>2.链接哪个表<br>3.链接条件<br>4.where条件</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/12/06/sql使用规范/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="王靖尧">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="王靖尧的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/06/sql使用规范/" itemprop="url">sql使用规范</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-12-06T18:11:56+08:00">
                2018-12-06
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="基础规范"><a href="#基础规范" class="headerlink" title="基础规范"></a>基础规范</h3><p>表存储引擎必须使用InnoDB</p>
<p>表字符集默认使用utf8，必要时候使用utf8mb4<br>解读：<br>（1）通用，无乱码风险，汉字3字节，英文1字节<br>（2）utf8mb4是utf8的超集，有存储4字节例如表情符号时，使用它</p>
<p>禁止使用存储过程，视图，触发器，Event<br>解读：<br>（1）对数据库性能影响较大，互联网业务，能让站点层和服务层干的事情，不要交到数据库层<br>（2）调试，排错，迁移都比较困难，扩展性较差</p>
<p>禁止在线上环境做数据库压力测试<br>测试，开发，线上数据库环境必须隔离</p>
<h3 id="二、命名规范"><a href="#二、命名规范" class="headerlink" title="二、命名规范"></a>二、命名规范</h3><p>库名，表名，列名必须用小写，采用下划线分隔<br>解读：abc，Abc，ABC都是给自己埋坑</p>
<p>库名，表名，列名必须见名知义，长度不要超过32字符<br>解读：tmp，wushan谁TM知道这些库是干嘛的</p>
<p>库备份必须以bak为前缀，以日期为后缀<br>从库必须以-s为后缀<br>备库必须以-ss为后缀</p>
<h3 id="三、表设计规范"><a href="#三、表设计规范" class="headerlink" title="三、表设计规范"></a>三、表设计规范</h3><p>单实例表个数必须控制在2000个以内<br>单表分表个数必须控制在1024个以内<br>表必须有主键，推荐使用UNSIGNED整数为主键<br>潜在坑：删除无主键的表，如果是row模式的主从架构，从库会挂住</p>
<p>禁止使用外键，如果要保证完整性，应由代码实现<br>解读：外键使得表之间相互耦合，影响update/delete等SQL性能，有可能造成死锁，高并发情况下容易成为数据库瓶颈</p>
<p>建议将大字段，访问频度低的字段拆分到单独的表中存储，分离冷热数据</p>
<h3 id="四、列设计规范"><a href="#四、列设计规范" class="headerlink" title="四、列设计规范"></a>四、列设计规范</h3><p>根据业务区分使用tinyint/int/bigint，分别会占用1/4/8字节<br>根据业务区分使用char/varchar</p>
<p>解读：<br>（1）字段长度固定，或者长度近似的业务场景，适合使用char，能够减少碎片，查询性能高<br>（2）字段长度相差较大，或者更新较少的业务场景，适合使用varchar，能够减少空间</p>
<p>根据业务区分使用datetime/timestamp<br>解读：前者占用5个字节，后者占用4个字节，存储年使用YEAR，存储日期使用DATE，存储时间使用datetime</p>
<p>必须把字段定义为NOT NULL并设默认值<br>解读：<br>（1）NULL的列使用索引，索引统计，值都更加复杂，MySQL更难优化<br>（2）NULL需要更多的存储空间<br>（3）NULL只能采用IS NULL或者IS NOT NULL，而在=/!=/in/not in时有大坑</p>
<p>使用INT UNSIGNED存储IPv4，不要用char(15)</p>
<p>使用varchar(20)存储手机号，不要使用整数<br>解读：<br>（1）牵扯到国家代号，可能出现+/-/()等字符，例如+86<br>（2）手机号不会用来做数学运算<br>（3）varchar可以模糊查询，例如like ‘138%’</p>
<p>使用TINYINT来代替ENUM<br>解读：ENUM增加新值要进行DDL操作</p>
<h3 id="索引规范"><a href="#索引规范" class="headerlink" title="索引规范"></a>索引规范</h3><p>唯一索引使用uniq_[字段名]来命名<br>非唯一索引使用idx_[字段名]来命名<br>单张表索引数量建议控制在5个以内<br>解读：<br>（1）互联网高并发业务，太多索引会影响写性能<br>（2）生成执行计划时，如果索引太多，会降低性能，并可能导致MySQL选择不到最优索引<br>（3）异常复杂的查询需求，可以选择ES等更为适合的方式存储</p>
<p>组合索引字段数不建议超过5个<br>解读：如果5个字段还不能极大缩小row范围，八成是设计有问题</p>
<p>不建议在频繁更新的字段上建立索引<br>非必要不要进行JOIN查询，如果要进行JOIN查询，被JOIN的字段必须类型相同，并建立索引<br>解读：踩过因为JOIN字段类型不一致，而导致全表扫描的坑么？</p>
<p>理解组合索引最左前缀原则，避免重复建设索引，如果建立了(a,b,c)，相当于建立了(a), (a,b), (a,b,c)</p>
<h3 id="六、SQL规范"><a href="#六、SQL规范" class="headerlink" title="六、SQL规范"></a>六、SQL规范</h3><p>禁止使用select <em>，只获取必要字段<br>解读：<br>（1）select </em>会增加cpu/io/内存/带宽的消耗<br>（2）指定字段能有效利用索引覆盖<br>（3）指定字段查询，在表结构变更时，能保证对应用程序无影响</p>
<p>insert必须指定字段，禁止使用insert into T values()<br>解读：指定字段插入，在表结构变更时，能保证对应用程序无影响</p>
<p>隐式类型转换会使索引失效，导致全表扫描</p>
<p>禁止在where条件列使用函数或者表达式<br>解读：导致不能命中索引，全表扫描</p>
<p>禁止负向查询以及%开头的模糊查询<br>解读：导致不能命中索引，全表扫描</p>
<p>禁止大表JOIN和子查询<br>同一个字段上的OR必须改写问IN，IN的值必须少于50个<br>应用程序必须捕获SQL异常<br>解读：方便定位线上问题</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/12/06/redis基本使用/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="王靖尧">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="王靖尧的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/06/redis基本使用/" itemprop="url">redis基本使用</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-12-06T18:10:43+08:00">
                2018-12-06
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="redis是什么"><a href="#redis是什么" class="headerlink" title="redis是什么"></a>redis是什么</h3><p>redis是一个开源的，实用C语言编写的，支持网络交互的、可基于内存也可持久化的Key-Value数据库</p>
<h3 id="安装过程-略"><a href="#安装过程-略" class="headerlink" title="安装过程  略"></a>安装过程  略</h3><h3 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br></pre></td><td class="code"><pre><span class="line">public class RedisClient &#123;</span><br><span class="line"></span><br><span class="line">	private Jedis jedis;// 非切片客户端连接</span><br><span class="line">	private JedisPool jedisPool;// 非切片连接池</span><br><span class="line">	private ShardedJedis shardedJedis;// 切片客户端连接</span><br><span class="line">	private ShardedJedisPool shardedJedisPool;// 切片连接池</span><br><span class="line"></span><br><span class="line">	public RedisClient() &#123;</span><br><span class="line">		initialPool();</span><br><span class="line">		initialShardedPool();</span><br><span class="line">		shardedJedis = shardedJedisPool.getResource();</span><br><span class="line">		jedis = jedisPool.getResource();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * 初始化非切片连接池</span><br><span class="line">	 */</span><br><span class="line">	private void initialPool() &#123;</span><br><span class="line">		// 池基本配置</span><br><span class="line">		JedisPoolConfig config = new JedisPoolConfig();</span><br><span class="line">		//可用连接实例的最大数目，默认值为8</span><br><span class="line">		config.setMaxActive(20);</span><br><span class="line">		//控制一个pool最多有多少个状态为idle(空闲的)的jedis实例，默认值也是8</span><br><span class="line">		config.setMaxIdle(5);</span><br><span class="line">		//等待可用连接的最大时间，单位毫秒，默认值为-1，表示永不超时。如果超过等待时间，则直接抛出JedisConnectionException</span><br><span class="line">		config.setMaxWait(1000l);</span><br><span class="line">		config.setTestOnBorrow(false);</span><br><span class="line"></span><br><span class="line">		jedisPool = new JedisPool(config, &quot;127.0.0.1&quot;, 6379);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * 初始化切片池</span><br><span class="line">	 */</span><br><span class="line">	private void initialShardedPool() &#123;</span><br><span class="line">		// 池基本配置</span><br><span class="line">		JedisPoolConfig config = new JedisPoolConfig();</span><br><span class="line">		config.setMaxActive(20);</span><br><span class="line">		config.setMaxIdle(5);</span><br><span class="line">		config.setMaxWait(1000l);</span><br><span class="line">		config.setTestOnBorrow(false);</span><br><span class="line">		// slave链接</span><br><span class="line">		List&lt;JedisShardInfo&gt; shards = new ArrayList&lt;JedisShardInfo&gt;();</span><br><span class="line">		shards.add(new JedisShardInfo(&quot;127.0.0.1&quot;, 6379, &quot;master&quot;));</span><br><span class="line"></span><br><span class="line">		// 构造池</span><br><span class="line">		shardedJedisPool = new ShardedJedisPool(config, shards);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public void show() &#123;</span><br><span class="line">		KeyOperate();</span><br><span class="line">		StringOperate();</span><br><span class="line">		ListOperate();</span><br><span class="line">		SetOperate();</span><br><span class="line">		SortedSetOperate();</span><br><span class="line">		HashOperate();</span><br><span class="line">		jedisPool.returnResource(jedis);</span><br><span class="line">		shardedJedisPool.returnResource(shardedJedis);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	/**</span><br><span class="line">	 * key 功能 </span><br><span class="line">	 * 1.清空所有数据 jedis.flushDB()</span><br><span class="line">	 * 2.判断键是否存在 shardedJedis.exists(&quot;key1&quot;)</span><br><span class="line">	 * 3.新增键值对 shardedJedis.set(&quot;key001&quot;, &quot;value001&quot;)</span><br><span class="line">	 * 4.删除某个key,若key不存在，则忽略该命令 jedis.del(&quot;key002&quot;)</span><br><span class="line">	 * 5.设置 key001的过期时间 jedis.expire(&quot;key001&quot;, 5)</span><br><span class="line">	 * 6.查看某个key的剩余生存时间,单位【秒】.永久生存或者不存在的都返回-1  jedis.ttl(&quot;key001&quot;)</span><br><span class="line">	 * 7.移除某个key的生存时间  jedis.persist(&quot;key001&quot;)</span><br><span class="line">	 * 8.查看key所储存的值的类型 jedis.type(&quot;key001&quot;)</span><br><span class="line">	 * </span><br><span class="line">	 */</span><br><span class="line">	private void KeyOperate() &#123;</span><br><span class="line">		System.out.println(&quot;======================key==========================&quot;);</span><br><span class="line">		// 清空数据</span><br><span class="line">		System.out.println(&quot;清空库中所有数据：&quot; + jedis.flushDB());</span><br><span class="line">		// 判断key否存在</span><br><span class="line">		System.out.println(&quot;判断key999键是否存在：&quot; + shardedJedis.exists(&quot;key999&quot;));</span><br><span class="line">		System.out.println(&quot;新增key001,value001键值对：&quot; + shardedJedis.set(&quot;key001&quot;, &quot;value001&quot;));</span><br><span class="line">		System.out.println(&quot;判断key001是否存在：&quot; + shardedJedis.exists(&quot;key001&quot;));</span><br><span class="line">		// 输出系统中所有的key</span><br><span class="line">		System.out.println(&quot;新增key002,value002键值对：&quot; + shardedJedis.set(&quot;key002&quot;, &quot;value002&quot;));</span><br><span class="line">		System.out.println(&quot;系统中所有键如下：&quot;);</span><br><span class="line">		Set&lt;String&gt; keys = jedis.keys(&quot;*&quot;);</span><br><span class="line">		Iterator&lt;String&gt; it = keys.iterator();</span><br><span class="line">		while (it.hasNext()) &#123;</span><br><span class="line">			String key = it.next();</span><br><span class="line">			System.out.println(key);</span><br><span class="line">		&#125;</span><br><span class="line">		// 删除某个key,若key不存在，则忽略该命令。</span><br><span class="line">		System.out.println(&quot;系统中删除key002: &quot; + jedis.del(&quot;key002&quot;));</span><br><span class="line">		System.out.println(&quot;判断key002是否存在：&quot; + shardedJedis.exists(&quot;key002&quot;));</span><br><span class="line">		// 设置 key001的过期时间</span><br><span class="line">		System.out.println(&quot;设置 key001的过期时间为5秒:&quot; + jedis.expire(&quot;key001&quot;, 5));</span><br><span class="line">		try &#123;</span><br><span class="line">			Thread.sleep(2000);</span><br><span class="line">		&#125; catch (InterruptedException e) &#123;</span><br><span class="line">		&#125;</span><br><span class="line">		// 查看某个key的剩余生存时间,单位【秒】.永久生存或者不存在的都返回-1</span><br><span class="line">		System.out.println(&quot;查看key001的剩余生存时间：&quot; + jedis.ttl(&quot;key001&quot;));</span><br><span class="line">		// 移除某个key的生存时间</span><br><span class="line">		System.out.println(&quot;移除key001的生存时间：&quot; + jedis.persist(&quot;key001&quot;));</span><br><span class="line">		System.out.println(&quot;查看key001的剩余生存时间：&quot; + jedis.ttl(&quot;key001&quot;));</span><br><span class="line">		// 查看key所储存的值的类型</span><br><span class="line">		System.out.println(&quot;查看key所储存的值的类型：&quot; + jedis.type(&quot;key001&quot;));</span><br><span class="line">		/*</span><br><span class="line">		 * 一些其他方法：1、修改键名：jedis.rename(&quot;key6&quot;, &quot;key0&quot;);</span><br><span class="line">		 * 2、将当前db的key移动到给定的db当中：jedis.move(&quot;foo&quot;, 1)</span><br><span class="line">		 */</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * String功能</span><br><span class="line">	 * 1.一次性新增key201,key202  jedis.mset(&quot;key201&quot;, &quot;value201&quot;, &quot;key202&quot;, &quot;value202&quot;)</span><br><span class="line">	 * 2.一次性删除key201,key202  jedis.del(new String[] &#123; &quot;key201&quot;, &quot;key202&quot; &#125;</span><br><span class="line">	 * 3.一次性获取key201,key202  jedis.mget(&quot;key201&quot;, &quot;key202&quot;)</span><br><span class="line">	 * 4.新增键值对时防止覆盖原先值  shardedJedis.setnx(&quot;key302&quot;, &quot;value302_new&quot;)</span><br><span class="line">	 * 5.获取原值，更新为新值一步完成 shardedJedis.getSet(&quot;key302&quot;, &quot;value302-after-getset&quot;)</span><br><span class="line">	 * 6.获取key302对应值中的子串   shardedJedis.getrange(&quot;key302&quot;, 5, 7)</span><br><span class="line">	 * </span><br><span class="line">	 */</span><br><span class="line">	private void StringOperate() &#123;</span><br><span class="line">		System.out.println(&quot;======================String_1==========================&quot;);</span><br><span class="line">		// 清空数据</span><br><span class="line">		System.out.println(&quot;清空库中所有数据：&quot; + jedis.flushDB());</span><br><span class="line"></span><br><span class="line">		System.out.println(&quot;=============增=============&quot;);</span><br><span class="line">		jedis.set(&quot;key001&quot;, &quot;value001&quot;);</span><br><span class="line">		jedis.set(&quot;key002&quot;, &quot;value002&quot;);</span><br><span class="line">		jedis.set(&quot;key003&quot;, &quot;value003&quot;);</span><br><span class="line">		System.out.println(&quot;已新增的3个键值对如下：&quot;);</span><br><span class="line">		System.out.println(jedis.get(&quot;key001&quot;));</span><br><span class="line">		System.out.println(jedis.get(&quot;key002&quot;));</span><br><span class="line">		System.out.println(jedis.get(&quot;key003&quot;));</span><br><span class="line"></span><br><span class="line">		System.out.println(&quot;=============删=============&quot;);</span><br><span class="line">		System.out.println(&quot;删除key003键值对：&quot; + jedis.del(&quot;key003&quot;));</span><br><span class="line">		System.out.println(&quot;获取key003键对应的值：&quot; + jedis.get(&quot;key003&quot;));</span><br><span class="line"></span><br><span class="line">		System.out.println(&quot;=============改=============&quot;);</span><br><span class="line">		// 1、直接覆盖原来的数据</span><br><span class="line">		System.out.println(&quot;直接覆盖key001原来的数据：&quot; + jedis.set(&quot;key001&quot;, &quot;value001-update&quot;));</span><br><span class="line">		System.out.println(&quot;获取key001对应的新值：&quot; + jedis.get(&quot;key001&quot;));</span><br><span class="line">		// 2、直接覆盖原来的数据</span><br><span class="line">		System.out.println(&quot;在key002原来值后面追加：&quot; + jedis.append(&quot;key002&quot;, &quot;+appendString&quot;));</span><br><span class="line">		System.out.println(&quot;获取key002对应的新值&quot; + jedis.get(&quot;key002&quot;));</span><br><span class="line"></span><br><span class="line">		System.out.println(&quot;=============增，删，查（多个）=============&quot;);</span><br><span class="line">		/**</span><br><span class="line">		 * mset,mget同时新增，修改，查询多个键值对 等价于： jedis.set(&quot;name&quot;,&quot;ssss&quot;);</span><br><span class="line">		 * jedis.set(&quot;jarorwar&quot;,&quot;xxxx&quot;);</span><br><span class="line">		 */</span><br><span class="line">		System.out.println(&quot;一次性新增key201,key202,key203,key204及其对应值：&quot;</span><br><span class="line">				+ jedis.mset(&quot;key201&quot;, &quot;value201&quot;, &quot;key202&quot;, &quot;value202&quot;, &quot;key203&quot;, &quot;value203&quot;, &quot;key204&quot;, &quot;value204&quot;));</span><br><span class="line">		System.out.println(</span><br><span class="line">				&quot;一次性获取key201,key202,key203,key204各自对应的值：&quot; + jedis.mget(&quot;key201&quot;, &quot;key202&quot;, &quot;key203&quot;, &quot;key204&quot;));</span><br><span class="line">		System.out.println(&quot;一次性删除key201,key202：&quot; + jedis.del(new String[] &#123; &quot;key201&quot;, &quot;key202&quot; &#125;));</span><br><span class="line">		System.out.println(</span><br><span class="line">				&quot;一次性获取key201,key202,key203,key204各自对应的值：&quot; + jedis.mget(&quot;key201&quot;, &quot;key202&quot;, &quot;key203&quot;, &quot;key204&quot;));</span><br><span class="line">		System.out.println();</span><br><span class="line"></span><br><span class="line">		// jedis具备的功能shardedJedis中也可直接使用，下面测试一些前面没用过的方法</span><br><span class="line">		System.out.println(&quot;======================String_2==========================&quot;);</span><br><span class="line">		// 清空数据</span><br><span class="line">		System.out.println(&quot;清空库中所有数据：&quot; + jedis.flushDB());</span><br><span class="line"></span><br><span class="line">		System.out.println(&quot;=============新增键值对时防止覆盖原先值=============&quot;);</span><br><span class="line">		System.out.println(&quot;原先key301不存在时，新增key301：&quot; + shardedJedis.setnx(&quot;key301&quot;, &quot;value301&quot;));</span><br><span class="line">		System.out.println(&quot;原先key302不存在时，新增key302：&quot; + shardedJedis.setnx(&quot;key302&quot;, &quot;value302&quot;));</span><br><span class="line">		System.out.println(&quot;当key302存在时，尝试新增key302：&quot; + shardedJedis.setnx(&quot;key302&quot;, &quot;value302_new&quot;));</span><br><span class="line">		System.out.println(&quot;获取key301对应的值：&quot; + shardedJedis.get(&quot;key301&quot;));</span><br><span class="line">		System.out.println(&quot;获取key302对应的值：&quot; + shardedJedis.get(&quot;key302&quot;));</span><br><span class="line"></span><br><span class="line">		System.out.println(&quot;=============超过有效期键值对被删除=============&quot;);</span><br><span class="line">		// 设置key的有效期，并存储数据</span><br><span class="line">		System.out.println(&quot;新增key303，并指定过期时间为2秒&quot; + shardedJedis.setex(&quot;key303&quot;, 2, &quot;key303-2second&quot;));</span><br><span class="line">		System.out.println(&quot;获取key303对应的值：&quot; + shardedJedis.get(&quot;key303&quot;));</span><br><span class="line">		try &#123;</span><br><span class="line">			Thread.sleep(3000);</span><br><span class="line">		&#125; catch (InterruptedException e) &#123;</span><br><span class="line">		&#125;</span><br><span class="line">		System.out.println(&quot;3秒之后，获取key303对应的值：&quot; + shardedJedis.get(&quot;key303&quot;));</span><br><span class="line"></span><br><span class="line">		System.out.println(&quot;=============获取原值，更新为新值一步完成=============&quot;);</span><br><span class="line">		System.out.println(&quot;key302原值：&quot; + shardedJedis.getSet(&quot;key302&quot;, &quot;value302-after-getset&quot;));</span><br><span class="line">		System.out.println(&quot;key302新值：&quot; + shardedJedis.get(&quot;key302&quot;));</span><br><span class="line"></span><br><span class="line">		System.out.println(&quot;=============获取子串=============&quot;);</span><br><span class="line">		System.out.println(&quot;获取key302对应值中的子串：&quot; + shardedJedis.getrange(&quot;key302&quot;, 5, 7));</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	/**</span><br><span class="line">	 * List功能</span><br><span class="line">	 * 1.</span><br><span class="line">	 * 2.</span><br><span class="line">	 * 3.</span><br><span class="line">	 * 4.</span><br><span class="line">	 * 5.</span><br><span class="line">	 * 6.</span><br><span class="line">	 * 7.</span><br><span class="line">	 * 8.</span><br><span class="line">	 * </span><br><span class="line">	 */</span><br><span class="line">	private void ListOperate() &#123;</span><br><span class="line">		System.out.println(&quot;======================list==========================&quot;);</span><br><span class="line">		// 清空数据</span><br><span class="line">		System.out.println(&quot;清空库中所有数据：&quot; + jedis.flushDB());</span><br><span class="line"></span><br><span class="line">		System.out.println(&quot;=============增=============&quot;);</span><br><span class="line">		shardedJedis.lpush(&quot;stringlists&quot;, &quot;vector&quot;);</span><br><span class="line">		shardedJedis.lpush(&quot;stringlists&quot;, &quot;ArrayList&quot;);</span><br><span class="line">		shardedJedis.lpush(&quot;stringlists&quot;, &quot;vector&quot;);</span><br><span class="line">		shardedJedis.lpush(&quot;stringlists&quot;, &quot;vector&quot;);</span><br><span class="line">		shardedJedis.lpush(&quot;stringlists&quot;, &quot;LinkedList&quot;);</span><br><span class="line">		shardedJedis.lpush(&quot;stringlists&quot;, &quot;MapList&quot;);</span><br><span class="line">		shardedJedis.lpush(&quot;stringlists&quot;, &quot;SerialList&quot;);</span><br><span class="line">		shardedJedis.lpush(&quot;stringlists&quot;, &quot;HashList&quot;);</span><br><span class="line">		shardedJedis.lpush(&quot;numberlists&quot;, &quot;3&quot;);</span><br><span class="line">		shardedJedis.lpush(&quot;numberlists&quot;, &quot;1&quot;);</span><br><span class="line">		shardedJedis.lpush(&quot;numberlists&quot;, &quot;5&quot;);</span><br><span class="line">		shardedJedis.lpush(&quot;numberlists&quot;, &quot;2&quot;);</span><br><span class="line">		System.out.println(&quot;所有元素-stringlists：&quot; + shardedJedis.lrange(&quot;stringlists&quot;, 0, -1));</span><br><span class="line">		System.out.println(&quot;所有元素-numberlists：&quot; + shardedJedis.lrange(&quot;numberlists&quot;, 0, -1));</span><br><span class="line"></span><br><span class="line">		System.out.println(&quot;=============删=============&quot;);</span><br><span class="line">		// 删除列表指定的值 ，第二个参数为删除的个数（有重复时），后add进去的值先被删，类似于出栈</span><br><span class="line">		System.out.println(&quot;成功删除指定元素个数-stringlists：&quot; + shardedJedis.lrem(&quot;stringlists&quot;, 2, &quot;vector&quot;));</span><br><span class="line">		System.out.println(&quot;删除指定元素之后-stringlists：&quot; + shardedJedis.lrange(&quot;stringlists&quot;, 0, -1));</span><br><span class="line">		// 删除区间以外的数据</span><br><span class="line">		System.out.println(&quot;删除下标0-3区间之外的元素：&quot; + shardedJedis.ltrim(&quot;stringlists&quot;, 0, 3));</span><br><span class="line">		System.out.println(&quot;删除指定区间之外元素后-stringlists：&quot; + shardedJedis.lrange(&quot;stringlists&quot;, 0, -1));</span><br><span class="line">		// 列表元素出栈</span><br><span class="line">		System.out.println(&quot;出栈元素：&quot; + shardedJedis.lpop(&quot;stringlists&quot;));</span><br><span class="line">		System.out.println(&quot;元素出栈后-stringlists：&quot; + shardedJedis.lrange(&quot;stringlists&quot;, 0, -1));</span><br><span class="line"></span><br><span class="line">		System.out.println(&quot;=============改=============&quot;);</span><br><span class="line">		// 修改列表中指定下标的值</span><br><span class="line">		shardedJedis.lset(&quot;stringlists&quot;, 0, &quot;hello list!&quot;);</span><br><span class="line">		System.out.println(&quot;下标为0的值修改后-stringlists：&quot; + shardedJedis.lrange(&quot;stringlists&quot;, 0, -1));</span><br><span class="line">		System.out.println(&quot;=============查=============&quot;);</span><br><span class="line">		// 数组长度</span><br><span class="line">		System.out.println(&quot;长度-stringlists：&quot; + shardedJedis.llen(&quot;stringlists&quot;));</span><br><span class="line">		System.out.println(&quot;长度-numberlists：&quot; + shardedJedis.llen(&quot;numberlists&quot;));</span><br><span class="line">		// 排序</span><br><span class="line">		/*</span><br><span class="line">		 * list中存字符串时必须指定参数为alpha，如果不使用SortingParams，而是直接使用sort(&quot;list&quot;)，</span><br><span class="line">		 * 会出现&quot;ERR One or more scores can&apos;t be converted into double&quot;</span><br><span class="line">		 */</span><br><span class="line">		SortingParams sortingParameters = new SortingParams();</span><br><span class="line">		sortingParameters.alpha();</span><br><span class="line">		sortingParameters.limit(0, 3);</span><br><span class="line">		System.out.println(&quot;返回排序后的结果-stringlists：&quot; + shardedJedis.sort(&quot;stringlists&quot;, sortingParameters));</span><br><span class="line">		System.out.println(&quot;返回排序后的结果-numberlists：&quot; + shardedJedis.sort(&quot;numberlists&quot;));</span><br><span class="line">		// 子串： start为元素下标，end也为元素下标；-1代表倒数一个元素，-2代表倒数第二个元素</span><br><span class="line">		System.out.println(&quot;子串-第二个开始到结束：&quot; + shardedJedis.lrange(&quot;stringlists&quot;, 1, -1));</span><br><span class="line">		// 获取列表指定下标的值</span><br><span class="line">		System.out.println(&quot;获取下标为2的元素：&quot; + shardedJedis.lindex(&quot;stringlists&quot;, 2) + &quot;\n&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	/**</span><br><span class="line">	 * Set功能</span><br><span class="line">	 * 1.</span><br><span class="line">	 * 2.</span><br><span class="line">	 * 3.</span><br><span class="line">	 * 4.</span><br><span class="line">	 * 5.</span><br><span class="line">	 * 6.</span><br><span class="line">	 * 7.</span><br><span class="line">	 * 8.</span><br><span class="line">	 * </span><br><span class="line">	 */</span><br><span class="line">	private void SetOperate() &#123;</span><br><span class="line"></span><br><span class="line">		System.out.println(&quot;======================set==========================&quot;);</span><br><span class="line">		// 清空数据</span><br><span class="line">		System.out.println(&quot;清空库中所有数据：&quot; + jedis.flushDB());</span><br><span class="line"></span><br><span class="line">		System.out.println(&quot;=============增=============&quot;);</span><br><span class="line">		System.out.println(&quot;向sets集合中加入元素element001：&quot; + jedis.sadd(&quot;sets&quot;, &quot;element001&quot;));</span><br><span class="line">		System.out.println(&quot;向sets集合中加入元素element002：&quot; + jedis.sadd(&quot;sets&quot;, &quot;element002&quot;));</span><br><span class="line">		System.out.println(&quot;向sets集合中加入元素element003：&quot; + jedis.sadd(&quot;sets&quot;, &quot;element003&quot;));</span><br><span class="line">		System.out.println(&quot;向sets集合中加入元素element004：&quot; + jedis.sadd(&quot;sets&quot;, &quot;element004&quot;));</span><br><span class="line">		System.out.println(&quot;查看sets集合中的所有元素:&quot; + jedis.smembers(&quot;sets&quot;));</span><br><span class="line">		System.out.println();</span><br><span class="line"></span><br><span class="line">		System.out.println(&quot;=============删=============&quot;);</span><br><span class="line">		System.out.println(&quot;集合sets中删除元素element003：&quot; + jedis.srem(&quot;sets&quot;, &quot;element003&quot;));</span><br><span class="line">		System.out.println(&quot;查看sets集合中的所有元素:&quot; + jedis.smembers(&quot;sets&quot;));</span><br><span class="line">		/*</span><br><span class="line">		 * System.out.println(&quot;sets集合中任意位置的元素出栈：&quot;+jedis.spop(&quot;sets&quot;));//注：</span><br><span class="line">		 * 出栈元素位置居然不定？--无实际意义</span><br><span class="line">		 * System.out.println(&quot;查看sets集合中的所有元素:&quot;+jedis.smembers(&quot;sets&quot;));</span><br><span class="line">		 */</span><br><span class="line">		System.out.println();</span><br><span class="line"></span><br><span class="line">		System.out.println(&quot;=============改=============&quot;);</span><br><span class="line">		System.out.println();</span><br><span class="line"></span><br><span class="line">		System.out.println(&quot;=============查=============&quot;);</span><br><span class="line">		System.out.println(&quot;判断element001是否在集合sets中：&quot; + jedis.sismember(&quot;sets&quot;, &quot;element001&quot;));</span><br><span class="line">		System.out.println(&quot;循环查询获取sets中的每个元素：&quot;);</span><br><span class="line">		Set&lt;String&gt; set = jedis.smembers(&quot;sets&quot;);</span><br><span class="line">		Iterator&lt;String&gt; it = set.iterator();</span><br><span class="line">		while (it.hasNext()) &#123;</span><br><span class="line">			Object obj = it.next();</span><br><span class="line">			System.out.println(obj);</span><br><span class="line">		&#125;</span><br><span class="line">		System.out.println();</span><br><span class="line"></span><br><span class="line">		System.out.println(&quot;=============集合运算=============&quot;);</span><br><span class="line">		System.out.println(&quot;sets1中添加元素element001：&quot; + jedis.sadd(&quot;sets1&quot;, &quot;element001&quot;));</span><br><span class="line">		System.out.println(&quot;sets1中添加元素element002：&quot; + jedis.sadd(&quot;sets1&quot;, &quot;element002&quot;));</span><br><span class="line">		System.out.println(&quot;sets1中添加元素element003：&quot; + jedis.sadd(&quot;sets1&quot;, &quot;element003&quot;));</span><br><span class="line">		System.out.println(&quot;sets1中添加元素element002：&quot; + jedis.sadd(&quot;sets2&quot;, &quot;element002&quot;));</span><br><span class="line">		System.out.println(&quot;sets1中添加元素element003：&quot; + jedis.sadd(&quot;sets2&quot;, &quot;element003&quot;));</span><br><span class="line">		System.out.println(&quot;sets1中添加元素element004：&quot; + jedis.sadd(&quot;sets2&quot;, &quot;element004&quot;));</span><br><span class="line">		System.out.println(&quot;查看sets1集合中的所有元素:&quot; + jedis.smembers(&quot;sets1&quot;));</span><br><span class="line">		System.out.println(&quot;查看sets2集合中的所有元素:&quot; + jedis.smembers(&quot;sets2&quot;));</span><br><span class="line">		System.out.println(&quot;sets1和sets2交集：&quot; + jedis.sinter(&quot;sets1&quot;, &quot;sets2&quot;));</span><br><span class="line">		System.out.println(&quot;sets1和sets2并集：&quot; + jedis.sunion(&quot;sets1&quot;, &quot;sets2&quot;));</span><br><span class="line">		System.out.println(&quot;sets1和sets2差集：&quot; + jedis.sdiff(&quot;sets1&quot;, &quot;sets2&quot;));// 差集：set1中有，set2中没有的元素</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	/**</span><br><span class="line">	 * SortedSet功能</span><br><span class="line">	 * 1.</span><br><span class="line">	 * 2.</span><br><span class="line">	 * 3.</span><br><span class="line">	 * 4.</span><br><span class="line">	 * 5.</span><br><span class="line">	 * 6.</span><br><span class="line">	 * 7.</span><br><span class="line">	 * 8.</span><br><span class="line">	 * </span><br><span class="line">	 */</span><br><span class="line">	private void SortedSetOperate() &#123;</span><br><span class="line">		System.out.println(&quot;======================zset==========================&quot;);</span><br><span class="line">		// 清空数据</span><br><span class="line">		System.out.println(jedis.flushDB());</span><br><span class="line"></span><br><span class="line">		System.out.println(&quot;=============增=============&quot;);</span><br><span class="line">		System.out.println(&quot;zset中添加元素element001：&quot; + shardedJedis.zadd(&quot;zset&quot;, 7.0, &quot;element001&quot;));</span><br><span class="line">		System.out.println(&quot;zset中添加元素element002：&quot; + shardedJedis.zadd(&quot;zset&quot;, 8.0, &quot;element002&quot;));</span><br><span class="line">		System.out.println(&quot;zset中添加元素element003：&quot; + shardedJedis.zadd(&quot;zset&quot;, 2.0, &quot;element003&quot;));</span><br><span class="line">		System.out.println(&quot;zset中添加元素element004：&quot; + shardedJedis.zadd(&quot;zset&quot;, 3.0, &quot;element004&quot;));</span><br><span class="line">		System.out.println(&quot;zset集合中的所有元素：&quot; + shardedJedis.zrange(&quot;zset&quot;, 0, -1));// 按照权重值排序</span><br><span class="line">		System.out.println();</span><br><span class="line"></span><br><span class="line">		System.out.println(&quot;=============删=============&quot;);</span><br><span class="line">		System.out.println(&quot;zset中删除元素element002：&quot; + shardedJedis.zrem(&quot;zset&quot;, &quot;element002&quot;));</span><br><span class="line">		System.out.println(&quot;zset集合中的所有元素：&quot; + shardedJedis.zrange(&quot;zset&quot;, 0, -1));</span><br><span class="line">		System.out.println();</span><br><span class="line"></span><br><span class="line">		System.out.println(&quot;=============改=============&quot;);</span><br><span class="line">		System.out.println();</span><br><span class="line"></span><br><span class="line">		System.out.println(&quot;=============查=============&quot;);</span><br><span class="line">		System.out.println(&quot;统计zset集合中的元素中个数：&quot; + shardedJedis.zcard(&quot;zset&quot;));</span><br><span class="line">		System.out.println(&quot;统计zset集合中权重某个范围内（1.0——5.0），元素的个数：&quot; + shardedJedis.zcount(&quot;zset&quot;, 1.0, 5.0));</span><br><span class="line">		System.out.println(&quot;查看zset集合中element004的权重：&quot; + shardedJedis.zscore(&quot;zset&quot;, &quot;element004&quot;));</span><br><span class="line">		System.out.println(&quot;查看下标1到2范围内的元素值：&quot; + shardedJedis.zrange(&quot;zset&quot;, 1, 2));</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	/**</span><br><span class="line">	 * Hash功能</span><br><span class="line">	 * 1.</span><br><span class="line">	 * 2.</span><br><span class="line">	 * 3.</span><br><span class="line">	 * 4.</span><br><span class="line">	 * 5.</span><br><span class="line">	 * 6.</span><br><span class="line">	 * 7.</span><br><span class="line">	 * 8.</span><br><span class="line">	 * </span><br><span class="line">	 */</span><br><span class="line">	private void HashOperate() &#123;</span><br><span class="line">		System.out.println(&quot;======================hash==========================&quot;);</span><br><span class="line">		// 清空数据</span><br><span class="line">		System.out.println(jedis.flushDB());</span><br><span class="line"></span><br><span class="line">		System.out.println(&quot;=============增=============&quot;);</span><br><span class="line">		System.out.println(&quot;hashs中添加key001和value001键值对：&quot; + shardedJedis.hset(&quot;hashs&quot;, &quot;key001&quot;, &quot;value001&quot;));</span><br><span class="line">		System.out.println(&quot;hashs中添加key002和value002键值对：&quot; + shardedJedis.hset(&quot;hashs&quot;, &quot;key002&quot;, &quot;value002&quot;));</span><br><span class="line">		System.out.println(&quot;hashs中添加key003和value003键值对：&quot; + shardedJedis.hset(&quot;hashs&quot;, &quot;key003&quot;, &quot;value003&quot;));</span><br><span class="line">		System.out.println(&quot;新增key004和4的整型键值对：&quot; + shardedJedis.hincrBy(&quot;hashs&quot;, &quot;key004&quot;, 4l));</span><br><span class="line">		System.out.println(&quot;hashs中的所有值：&quot; + shardedJedis.hvals(&quot;hashs&quot;));</span><br><span class="line">		System.out.println();</span><br><span class="line"></span><br><span class="line">		System.out.println(&quot;=============删=============&quot;);</span><br><span class="line">		System.out.println(&quot;hashs中删除key002键值对：&quot; + shardedJedis.hdel(&quot;hashs&quot;, &quot;key002&quot;));</span><br><span class="line">		System.out.println(&quot;hashs中的所有值：&quot; + shardedJedis.hvals(&quot;hashs&quot;));</span><br><span class="line">		System.out.println();</span><br><span class="line"></span><br><span class="line">		System.out.println(&quot;=============改=============&quot;);</span><br><span class="line">		System.out.println(&quot;key004整型键值的值增加100：&quot; + shardedJedis.hincrBy(&quot;hashs&quot;, &quot;key004&quot;, 100l));</span><br><span class="line">		System.out.println(&quot;hashs中的所有值：&quot; + shardedJedis.hvals(&quot;hashs&quot;));</span><br><span class="line">		System.out.println();</span><br><span class="line"></span><br><span class="line">		System.out.println(&quot;=============查=============&quot;);</span><br><span class="line">		System.out.println(&quot;判断key003是否存在：&quot; + shardedJedis.hexists(&quot;hashs&quot;, &quot;key003&quot;));</span><br><span class="line">		System.out.println(&quot;获取key004对应的值：&quot; + shardedJedis.hget(&quot;hashs&quot;, &quot;key004&quot;));</span><br><span class="line">		System.out.println(&quot;批量获取key001和key003对应的值：&quot; + shardedJedis.hmget(&quot;hashs&quot;, &quot;key001&quot;, &quot;key003&quot;));</span><br><span class="line">		System.out.println(&quot;获取hashs中所有的key：&quot; + shardedJedis.hkeys(&quot;hashs&quot;));</span><br><span class="line">		System.out.println(&quot;获取hashs中所有的value：&quot; + shardedJedis.hvals(&quot;hashs&quot;));</span><br><span class="line">		System.out.println();</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	/**</span><br><span class="line">	 *  1）连接操作命令</span><br><span class="line">    quit：关闭连接（connection）</span><br><span class="line">    auth：简单密码认证</span><br><span class="line">    help cmd： 查看cmd帮助，例如：help quit</span><br><span class="line">    </span><br><span class="line">    2）持久化</span><br><span class="line">    save：将数据同步保存到磁盘</span><br><span class="line">    bgsave：将数据异步保存到磁盘</span><br><span class="line">    lastsave：返回上次成功将数据保存到磁盘的Unix时戳</span><br><span class="line">    shundown：将数据同步保存到磁盘，然后关闭服务</span><br><span class="line">    </span><br><span class="line">    3）远程服务控制</span><br><span class="line">    info：提供服务器的信息和统计</span><br><span class="line">    monitor：实时转储收到的请求</span><br><span class="line">    slaveof：改变复制策略设置</span><br><span class="line">    config：在运行时配置Redis服务器</span><br><span class="line">    </span><br><span class="line">    4）对value操作的命令</span><br><span class="line">    exists(key)：确认一个key是否存在</span><br><span class="line">    del(key)：删除一个key</span><br><span class="line">    type(key)：返回值的类型</span><br><span class="line">    keys(pattern)：返回满足给定pattern的所有key</span><br><span class="line">    randomkey：随机返回key空间的一个</span><br><span class="line">    keyrename(oldname, newname)：重命名key</span><br><span class="line">    dbsize：返回当前数据库中key的数目</span><br><span class="line">    expire：设定一个key的活动时间（s）</span><br><span class="line">    ttl：获得一个key的活动时间</span><br><span class="line">    select(index)：按索引查询</span><br><span class="line">    move(key, dbindex)：移动当前数据库中的key到dbindex数据库</span><br><span class="line">    flushdb：删除当前选择数据库中的所有key</span><br><span class="line">    flushall：删除所有数据库中的所有key</span><br><span class="line">    </span><br><span class="line">    5）String</span><br><span class="line">    set(key, value)：给数据库中名称为key的string赋予值value</span><br><span class="line">    get(key)：返回数据库中名称为key的string的value</span><br><span class="line">    getset(key, value)：给名称为key的string赋予上一次的value</span><br><span class="line">    mget(key1, key2,…, key N)：返回库中多个string的value</span><br><span class="line">    setnx(key, value)：添加string，名称为key，值为value</span><br><span class="line">    setex(key, time, value)：向库中添加string，设定过期时间time</span><br><span class="line">    mset(key N, value N)：批量设置多个string的值</span><br><span class="line">    msetnx(key N, value N)：如果所有名称为key i的string都不存在</span><br><span class="line">    incr(key)：名称为key的string增1操作</span><br><span class="line">    incrby(key, integer)：名称为key的string增加integer</span><br><span class="line">    decr(key)：名称为key的string减1操作</span><br><span class="line">    decrby(key, integer)：名称为key的string减少integer</span><br><span class="line">    append(key, value)：名称为key的string的值附加value</span><br><span class="line">    substr(key, start, end)：返回名称为key的string的value的子串</span><br><span class="line">    </span><br><span class="line">    6）List </span><br><span class="line">    rpush(key, value)：在名称为key的list尾添加一个值为value的元素</span><br><span class="line">    lpush(key, value)：在名称为key的list头添加一个值为value的 元素</span><br><span class="line">    llen(key)：返回名称为key的list的长度</span><br><span class="line">    lrange(key, start, end)：返回名称为key的list中start至end之间的元素</span><br><span class="line">    ltrim(key, start, end)：截取名称为key的list</span><br><span class="line">    lindex(key, index)：返回名称为key的list中index位置的元素</span><br><span class="line">    lset(key, index, value)：给名称为key的list中index位置的元素赋值</span><br><span class="line">    lrem(key, count, value)：删除count个key的list中值为value的元素</span><br><span class="line">    lpop(key)：返回并删除名称为key的list中的首元素</span><br><span class="line">    rpop(key)：返回并删除名称为key的list中的尾元素</span><br><span class="line">    blpop(key1, key2,… key N, timeout)：lpop命令的block版本。</span><br><span class="line">    brpop(key1, key2,… key N, timeout)：rpop的block版本。</span><br><span class="line">    rpoplpush(srckey, dstkey)：返回并删除名称为srckey的list的尾元素，</span><br><span class="line"></span><br><span class="line">　　　　　　　　　　　　　　并将该元素添加到名称为dstkey的list的头部</span><br><span class="line">    </span><br><span class="line">    7）Set</span><br><span class="line">    sadd(key, member)：向名称为key的set中添加元素member</span><br><span class="line">    srem(key, member) ：删除名称为key的set中的元素member</span><br><span class="line">    spop(key) ：随机返回并删除名称为key的set中一个元素</span><br><span class="line">    smove(srckey, dstkey, member) ：移到集合元素</span><br><span class="line">    scard(key) ：返回名称为key的set的基数</span><br><span class="line">    sismember(key, member) ：member是否是名称为key的set的元素</span><br><span class="line">    sinter(key1, key2,…key N) ：求交集</span><br><span class="line">    sinterstore(dstkey, (keys)) ：求交集并将交集保存到dstkey的集合</span><br><span class="line">    sunion(key1, (keys)) ：求并集</span><br><span class="line">    sunionstore(dstkey, (keys)) ：求并集并将并集保存到dstkey的集合</span><br><span class="line">    sdiff(key1, (keys)) ：求差集</span><br><span class="line">    sdiffstore(dstkey, (keys)) ：求差集并将差集保存到dstkey的集合</span><br><span class="line">    smembers(key) ：返回名称为key的set的所有元素</span><br><span class="line">    srandmember(key) ：随机返回名称为key的set的一个元素</span><br><span class="line">    </span><br><span class="line">    8）Hash</span><br><span class="line">    hset(key, field, value)：向名称为key的hash中添加元素field</span><br><span class="line">    hget(key, field)：返回名称为key的hash中field对应的value</span><br><span class="line">    hmget(key, (fields))：返回名称为key的hash中field i对应的value</span><br><span class="line">    hmset(key, (fields))：向名称为key的hash中添加元素field </span><br><span class="line">    hincrby(key, field, integer)：将名称为key的hash中field的value增加integer</span><br><span class="line">    hexists(key, field)：名称为key的hash中是否存在键为field的域</span><br><span class="line">    hdel(key, field)：删除名称为key的hash中键为field的域</span><br><span class="line">    hlen(key)：返回名称为key的hash中元素个数</span><br><span class="line">    hkeys(key)：返回名称为key的hash中所有键</span><br><span class="line">    hvals(key)：返回名称为key的hash中所有键对应的value</span><br><span class="line">    hgetall(key)：返回名称为key的hash中所有的键（field）及其对应的value</span><br><span class="line"></span><br><span class="line">	 * */</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/12/06/MySql主从复制-读写分离的实现/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="王靖尧">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="王靖尧的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/06/MySql主从复制-读写分离的实现/" itemprop="url">MySql主从复制+读写分离的实现</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-12-06T18:09:14+08:00">
                2018-12-06
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h3><p>1.本机，安装mysql<br>2.一台虚拟机，或内网中的另一台主机，安装mysql 需要两台机器互相可以ping通</p>
<h3 id="主数据库配置"><a href="#主数据库配置" class="headerlink" title="主数据库配置"></a>主数据库配置</h3><p>1.打开my.ini    (linux下为 /etc/my.cnf)<br>2.在mysqld下增加如下配置<br>log-bin=mysql-bin #slave会基于此log-bin来做replication<br>server-id=1 #master的标示<br>binlog-do-db = ms_test #用于master-slave的具体数据库<br>3.进入mysql<br>增加一个从数据库连接主数据库的用户名和密码<br>repl为用户名   10.20.147.111 为 从数据库IP，111111为密码<br><code>GRANT REPLICATION SLAVE ON *.* TO repl@10.20.147.111 IDENTIFIED BY &#39;111111&#39;;</code><br>4.重启mysql<br>5.进行mysql  输入 show master status<br>查看主数据库状态<br><img src="https://github.com/ayanamiq/images/blob/master/images/master_status.png?raw=true" alt=""></p>
<h3 id="配置从数据库"><a href="#配置从数据库" class="headerlink" title="配置从数据库"></a>配置从数据库</h3><p>1.编辑 mysql配置文件  /etc/my.cnf<br>2.在文件最后 增加一行<br>server-id=2   #slave 从数据库标识<br>保存退出 并且重启mysql<br>3.进入数据库<br> 输入<br>10.20.147.110 为主数据库IP<br>repl 连接主数据库的用户名<br>111111 连接主数据库的密码<br>mysql-bin.000003 是 show master status 中file字段的值<br>161261 是show master status 中position字段的值<br>CHANGE MASTER TO<br>MASTER_HOST=’10.20.147.110’,<br>MASTER_USER=’repl’,<br>MASTER_PASSWORD=’111111’,<br>MASTER_LOG_FILE=’mysql-bin.000003’,<br>MASTER_LOG_POS=161261;<br>4.启动从数据库<br>start slave;<br>5.查看从数据库状态<br>show slave status \G;</p>
<p>以上，实现了，主从复制，主数据库改变后，从数据库内容也会随之改变。反之亦然。<br>读写分离，需要借助代理来实现 </p>
<h3 id="安装amoeba-代理数据库"><a href="#安装amoeba-代理数据库" class="headerlink" title="安装amoeba 代理数据库"></a>安装amoeba 代理数据库</h3><p>1.下载压缩包<br>2.解压到本地<br>3.进入conf文件夹，编辑amoeba.xml配置文件<br>4.按照注释进行配置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;gbk&quot;?&gt;</span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE amoeba:configuration SYSTEM &quot;amoeba.dtd&quot;&gt;</span><br><span class="line">&lt;amoeba:configuration xmlns:amoeba=&quot;http://amoeba.meidusa.com/&quot;&gt;</span><br><span class="line"></span><br><span class="line">	&lt;server&gt;</span><br><span class="line">		&lt;!-- proxy server绑定的端口 --&gt;</span><br><span class="line">		&lt;property name=&quot;port&quot;&gt;8066&lt;/property&gt;</span><br><span class="line">		</span><br><span class="line">		&lt;!-- proxy server绑定的IP --&gt;</span><br><span class="line">		&lt;!-- </span><br><span class="line">		&lt;property name=&quot;ipAddress&quot;&gt;127.0.0.1&lt;/property&gt;</span><br><span class="line">		 --&gt;</span><br><span class="line">		&lt;!-- proxy server net IO Read thread size --&gt;</span><br><span class="line">		&lt;property name=&quot;readThreadPoolSize&quot;&gt;20&lt;/property&gt;</span><br><span class="line">		</span><br><span class="line">		&lt;!-- proxy server client process thread size --&gt;</span><br><span class="line">		&lt;property name=&quot;clientSideThreadPoolSize&quot;&gt;30&lt;/property&gt;</span><br><span class="line">		</span><br><span class="line">		&lt;!-- mysql server data packet process thread size --&gt;</span><br><span class="line">		&lt;property name=&quot;serverSideThreadPoolSize&quot;&gt;30&lt;/property&gt;</span><br><span class="line">		</span><br><span class="line">		&lt;!-- socket Send and receive BufferSize(unit:K)  --&gt;</span><br><span class="line">		&lt;property name=&quot;netBufferSize&quot;&gt;128&lt;/property&gt;</span><br><span class="line">		</span><br><span class="line">		&lt;!-- Enable/disable TCP_NODELAY (disable/enable Nagle&apos;s algorithm). --&gt;</span><br><span class="line">		&lt;property name=&quot;tcpNoDelay&quot;&gt;true&lt;/property&gt;</span><br><span class="line">		</span><br><span class="line">		&lt;!-- 对外验证的用户名 --&gt;</span><br><span class="line">		&lt;property name=&quot;user&quot;&gt;root&lt;/property&gt;</span><br><span class="line">		</span><br><span class="line">		&lt;!-- 对外验证的密码 --&gt;</span><br><span class="line">		</span><br><span class="line">		&lt;property name=&quot;password&quot;&gt;root&lt;/property&gt;</span><br><span class="line">		</span><br><span class="line">	&lt;/server&gt;</span><br><span class="line">	</span><br><span class="line">	&lt;!-- </span><br><span class="line">		每个ConnectionManager都将作为一个线程启动。</span><br><span class="line">		manager负责Connection IO读写/死亡检测</span><br><span class="line">	--&gt;</span><br><span class="line">	&lt;connectionManagerList&gt;</span><br><span class="line">		&lt;connectionManager name=&quot;defaultManager&quot; class=&quot;com.meidusa.amoeba.net.MultiConnectionManagerWrapper&quot;&gt;</span><br><span class="line">			&lt;property name=&quot;subManagerClassName&quot;&gt;com.meidusa.amoeba.net.AuthingableConnectionManager&lt;/property&gt;</span><br><span class="line">			</span><br><span class="line">			&lt;!-- </span><br><span class="line">			  default value is avaliable Processors </span><br><span class="line">			&lt;property name=&quot;processors&quot;&gt;5&lt;/property&gt;</span><br><span class="line">			 --&gt;</span><br><span class="line">		&lt;/connectionManager&gt;</span><br><span class="line">	&lt;/connectionManagerList&gt;</span><br><span class="line">	</span><br><span class="line">	&lt;dbServerList&gt;</span><br><span class="line">		&lt;!-- </span><br><span class="line">			一台mysqlServer 需要配置一个pool，</span><br><span class="line">			如果多台 平等的mysql需要进行loadBalance， </span><br><span class="line">			平台已经提供一个具有负载均衡能力的objectPool：com.meidusa.amoeba.mysql.server.MultipleServerPool</span><br><span class="line">			简单的配置是属性加上 virtual=&quot;true&quot;,该Pool 不允许配置factoryConfig</span><br><span class="line">			或者自己写一个ObjectPool。</span><br><span class="line">		--&gt;</span><br><span class="line">		&lt;!--主数据库配置--&gt;</span><br><span class="line">		&lt;dbServer name=&quot;server1&quot;&gt;</span><br><span class="line">			</span><br><span class="line">			&lt;!-- PoolableObjectFactory实现类 --&gt;</span><br><span class="line">			&lt;factoryConfig class=&quot;com.meidusa.amoeba.mysql.net.MysqlServerConnectionFactory&quot;&gt;</span><br><span class="line">				&lt;property name=&quot;manager&quot;&gt;defaultManager&lt;/property&gt;</span><br><span class="line">				</span><br><span class="line">				&lt;!-- 真实mysql数据库端口 --&gt;</span><br><span class="line">				&lt;!--主数据库端口 --&gt;</span><br><span class="line">				&lt;property name=&quot;port&quot;&gt;3306&lt;/property&gt;</span><br><span class="line">				</span><br><span class="line">				&lt;!-- 真实mysql数据库IP --&gt;</span><br><span class="line">				&lt;!--主数据库IP --&gt;</span><br><span class="line">				&lt;property name=&quot;ipAddress&quot;&gt;127.0.0.1&lt;/property&gt;</span><br><span class="line">				&lt;!--需要做主从的数据库名字--&gt;</span><br><span class="line">				&lt;property name=&quot;schema&quot;&gt;ms_test&lt;/property&gt;</span><br><span class="line">				</span><br><span class="line">				&lt;!-- 用于登陆mysql的用户名 --&gt;</span><br><span class="line">				&lt;!--主数据库用户名 --&gt;</span><br><span class="line">				&lt;property name=&quot;user&quot;&gt;root&lt;/property&gt;</span><br><span class="line">				</span><br><span class="line">				&lt;!-- 用于登陆mysql的密码 --&gt;	</span><br><span class="line">				&lt;!--主数据库密码 --&gt;				</span><br><span class="line">				&lt;property name=&quot;password&quot;&gt;root&lt;/property&gt;</span><br><span class="line">				</span><br><span class="line">				</span><br><span class="line">			&lt;/factoryConfig&gt;</span><br><span class="line">			</span><br><span class="line">			&lt;!-- ObjectPool实现类 --&gt;</span><br><span class="line">			&lt;poolConfig class=&quot;com.meidusa.amoeba.net.poolable.PoolableObjectPool&quot;&gt;</span><br><span class="line">				&lt;property name=&quot;maxActive&quot;&gt;200&lt;/property&gt;</span><br><span class="line">				&lt;property name=&quot;maxIdle&quot;&gt;200&lt;/property&gt;</span><br><span class="line">				&lt;property name=&quot;minIdle&quot;&gt;10&lt;/property&gt;</span><br><span class="line">				&lt;property name=&quot;minEvictableIdleTimeMillis&quot;&gt;600000&lt;/property&gt;</span><br><span class="line">				&lt;property name=&quot;timeBetweenEvictionRunsMillis&quot;&gt;600000&lt;/property&gt;</span><br><span class="line">				&lt;property name=&quot;testOnBorrow&quot;&gt;true&lt;/property&gt;</span><br><span class="line">				&lt;property name=&quot;testWhileIdle&quot;&gt;true&lt;/property&gt;</span><br><span class="line">			&lt;/poolConfig&gt;</span><br><span class="line">		&lt;/dbServer&gt;</span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">		&lt;!--从数据库配置--&gt;</span><br><span class="line">		&lt;dbServer name=&quot;server2&quot;&gt;</span><br><span class="line">			</span><br><span class="line">			&lt;!-- PoolableObjectFactory实现类 --&gt;</span><br><span class="line">			&lt;factoryConfig class=&quot;com.meidusa.amoeba.mysql.net.MysqlServerConnectionFactory&quot;&gt;</span><br><span class="line">				&lt;property name=&quot;manager&quot;&gt;defaultManager&lt;/property&gt;</span><br><span class="line">				</span><br><span class="line">				&lt;!-- 真实mysql数据库端口 --&gt;</span><br><span class="line">				&lt;!--从数据库端口--&gt;</span><br><span class="line">				&lt;property name=&quot;port&quot;&gt;3306&lt;/property&gt;</span><br><span class="line">				</span><br><span class="line">				&lt;!-- 真实mysql数据库IP --&gt;</span><br><span class="line">				&lt;!--从数据库IP--&gt;</span><br><span class="line">				&lt;property name=&quot;ipAddress&quot;&gt;192.168.11.151&lt;/property&gt;</span><br><span class="line">				&lt;property name=&quot;schema&quot;&gt;ms_test&lt;/property&gt;</span><br><span class="line">				</span><br><span class="line">				&lt;!-- 用于登陆mysql的用户名 --&gt;</span><br><span class="line">				&lt;!--从数据库用户名--&gt;</span><br><span class="line">				&lt;property name=&quot;user&quot;&gt;root&lt;/property&gt;</span><br><span class="line">				</span><br><span class="line">				&lt;!-- 用于登陆mysql的密码 --&gt;</span><br><span class="line">				&lt;!--从数据库密码--&gt;</span><br><span class="line">				&lt;property name=&quot;password&quot;&gt;MyNewPass1!&lt;/property&gt;</span><br><span class="line">			</span><br><span class="line">			&lt;/factoryConfig&gt;</span><br><span class="line">			</span><br><span class="line">			&lt;!-- ObjectPool实现类 --&gt;</span><br><span class="line">			&lt;poolConfig class=&quot;com.meidusa.amoeba.net.poolable.PoolableObjectPool&quot;&gt;</span><br><span class="line">				&lt;property name=&quot;maxActive&quot;&gt;200&lt;/property&gt;</span><br><span class="line">				&lt;property name=&quot;maxIdle&quot;&gt;200&lt;/property&gt;</span><br><span class="line">				&lt;property name=&quot;minIdle&quot;&gt;10&lt;/property&gt;</span><br><span class="line">				&lt;property name=&quot;minEvictableIdleTimeMillis&quot;&gt;600000&lt;/property&gt;</span><br><span class="line">				&lt;property name=&quot;timeBetweenEvictionRunsMillis&quot;&gt;600000&lt;/property&gt;</span><br><span class="line">				&lt;property name=&quot;testOnBorrow&quot;&gt;true&lt;/property&gt;</span><br><span class="line">				&lt;property name=&quot;testWhileIdle&quot;&gt;true&lt;/property&gt;</span><br><span class="line">			&lt;/poolConfig&gt;</span><br><span class="line">		&lt;/dbServer&gt;</span><br><span class="line">		</span><br><span class="line">		&lt;dbServer name=&quot;multiPool&quot; virtual=&quot;true&quot;&gt;</span><br><span class="line">			&lt;poolConfig class=&quot;com.meidusa.amoeba.server.MultipleServerPool&quot;&gt;</span><br><span class="line">				&lt;!-- 负载均衡参数 1=ROUNDROBIN , 2=WEIGHTBASED , 3=HA--&gt;</span><br><span class="line">				&lt;property name=&quot;loadbalance&quot;&gt;1&lt;/property&gt;</span><br><span class="line">				</span><br><span class="line">				&lt;!-- 参与该pool负载均衡的poolName列表以逗号分割 --&gt;</span><br><span class="line">				&lt;property name=&quot;poolNames&quot;&gt;server1&lt;/property&gt;</span><br><span class="line">			&lt;/poolConfig&gt;</span><br><span class="line">		&lt;/dbServer&gt;</span><br><span class="line">		</span><br><span class="line">	&lt;/dbServerList&gt;</span><br><span class="line">	</span><br><span class="line">	&lt;queryRouter class=&quot;com.meidusa.amoeba.mysql.parser.MysqlQueryRouter&quot;&gt;</span><br><span class="line">		&lt;!--</span><br><span class="line">		&lt;property name=&quot;ruleConfig&quot;&gt;$&#123;amoeba.home&#125;/conf/rule.xml&lt;/property&gt;</span><br><span class="line">		&lt;property name=&quot;functionConfig&quot;&gt;$&#123;amoeba.home&#125;/conf/functionMap.xml&lt;/property&gt;</span><br><span class="line">		&lt;property name=&quot;ruleFunctionConfig&quot;&gt;$&#123;amoeba.home&#125;/conf/ruleFunctionMap.xml&lt;/property&gt;</span><br><span class="line">		&lt;property name=&quot;LRUMapSize&quot;&gt;1500&lt;/property&gt;</span><br><span class="line">		&lt;property name=&quot;defaultPool&quot;&gt;server1&lt;/property&gt;</span><br><span class="line">		</span><br><span class="line">	</span><br><span class="line">		&lt;property name=&quot;writePool&quot;&gt;server1&lt;/property&gt;</span><br><span class="line">		&lt;property name=&quot;readPool&quot;&gt;server1&lt;/property&gt;</span><br><span class="line">		</span><br><span class="line">		&lt;property name=&quot;needParse&quot;&gt;true&lt;/property&gt;</span><br><span class="line">		--&gt;</span><br><span class="line">		&lt;property name=&quot;LRUMapSize&quot;&gt;1500&lt;/property&gt;  </span><br><span class="line">		&lt;property name=&quot;defaultPool&quot;&gt;server1&lt;/property&gt;  </span><br><span class="line">		&lt;property name=&quot;writePool&quot;&gt;server1&lt;/property&gt;  </span><br><span class="line">		&lt;property name=&quot;readPool&quot;&gt;server2&lt;/property&gt;  </span><br><span class="line">		&lt;property name=&quot;needParse&quot;&gt;true&lt;/property&gt; </span><br><span class="line">	&lt;/queryRouter&gt;</span><br><span class="line">&lt;/amoeba:configuration&gt;</span><br></pre></td></tr></table></figure></p>
<p>5.进入amoeba  bin文件夹<br>双击amoeba.bat启动<br>显示<br><img src="https://github.com/ayanamiq/images/blob/master/images/amoeba.png?raw=true" alt=""></p>
<h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><p>1.在主数据库建立一个表，从数据库无需建立表<br>2.编写一段JDBC代码测试<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">3. package msTest.test;</span><br><span class="line"></span><br><span class="line">import java.sql.Connection;</span><br><span class="line">import java.sql.DriverManager;</span><br><span class="line">import java.sql.PreparedStatement;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 数据库工具类</span><br><span class="line"> * @author muty</span><br><span class="line"> *</span><br><span class="line"> */</span><br><span class="line">public class DBUtil &#123;</span><br><span class="line">	</span><br><span class="line">	//amoeba数据库用户名</span><br><span class="line">	private static final String username = &quot;root&quot;;</span><br><span class="line">	</span><br><span class="line">	//amoeba数据库密码</span><br><span class="line">	private static final String password = &quot;root&quot;;</span><br><span class="line">	</span><br><span class="line">	//连接到哪一个数据库</span><br><span class="line">	private static final String db_name = &quot;ms_test&quot;;</span><br><span class="line">	</span><br><span class="line">	/**</span><br><span class="line">	 * Connection 数据库连接对象</span><br><span class="line">	 * java.sql.Connection</span><br><span class="line">	 * 获取数据库连接</span><br><span class="line">	 */</span><br><span class="line">	public static Connection getConnection()&#123;</span><br><span class="line">		Connection conn = null;</span><br><span class="line">		try&#123;</span><br><span class="line">			//加载数据库驱动</span><br><span class="line">			Class.forName(&quot;com.mysql.jdbc.Driver&quot;);</span><br><span class="line">			//拼接连接数据的地址和参数</span><br><span class="line">			String url = &quot;jdbc:mysql://localhost:8066/&quot;+db_name</span><br><span class="line">					+&quot;?user=&quot;+username+&quot;&amp;password=&quot;+password+&quot;&amp;characterEncoding=utf8&quot;;</span><br><span class="line">			System.out.println(url);</span><br><span class="line">			//获取连接</span><br><span class="line">			conn = DriverManager.getConnection(url);</span><br><span class="line">		&#125;catch(Exception e)&#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		return conn;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	public static void main(String[] args)&#123;</span><br><span class="line">		</span><br><span class="line">		try&#123;</span><br><span class="line">			Connection conn = DBUtil.getConnection();</span><br><span class="line">			PreparedStatement ps = conn.prepareStatement(&quot;insert into stu(name,age) values(?,?)&quot;);</span><br><span class="line">			ps.setString(1,&quot;测试学生&quot;);</span><br><span class="line">			ps.setInt(2, 25);</span><br><span class="line">			int r = ps.executeUpdate();</span><br><span class="line">			System.out.println(r);</span><br><span class="line">		&#125;catch(Exception e)&#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>4.执行代码，查看主数据库和从数据库，数据相同则证明配置成功</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/12/06/nginx负载均衡的简单配置/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="王靖尧">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="王靖尧的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/06/nginx负载均衡的简单配置/" itemprop="url">nginx负载均衡的简单配置</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-12-06T18:06:29+08:00">
                2018-12-06
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="1-下载-http-nginx-org"><a href="#1-下载-http-nginx-org" class="headerlink" title="1.下载 http://nginx.org/"></a>1.下载 <a href="http://nginx.org/" target="_blank" rel="noopener">http://nginx.org/</a></h3><h3 id="2-解压至英文路径"><a href="#2-解压至英文路径" class="headerlink" title="2.解压至英文路径"></a>2.解压至英文路径</h3><h3 id="3-进入解压后文件夹"><a href="#3-进入解压后文件夹" class="headerlink" title="3.进入解压后文件夹"></a>3.进入解压后文件夹</h3><p>双击nginx.exe启动nginx,默认为80端口，nginx启动时一闪而过，启动后打开浏览器，输入localhost，看到欢迎页面证明启动成功，若看不到欢迎页面，可能是80端口被占用<br>解决方法：进入nginx文件夹下的conf文件夹<br>编辑nginx.conf，找到server{listen   80;}修改端口号，重启nginx即可</p>
<h3 id="4-启动与停止"><a href="#4-启动与停止" class="headerlink" title="4.启动与停止"></a>4.启动与停止</h3><p>1.启动，windows下双击.exe文件<br>2.停止： nginx  –s  stop 即可<br>  若出现  nginx.pid 类似字样错误<br>        输入 nginx  –c  conf/nginx.conf<br>        输入后cmd会卡住，关闭即可，重新开启cmd，重复上述步骤停止nginx</p>
<h3 id="5-配置简单的负载均衡"><a href="#5-配置简单的负载均衡" class="headerlink" title="5.配置简单的负载均衡"></a>5.配置简单的负载均衡</h3><p>准备工作：<br>本机两个可以启动的tomcat，端口不同。<br>编辑conf/nginx.conf，添加如下配置：<br><img src="https://github.com/ayanamiq/images/blob/master/images/nginx_conf1.png?raw=true" alt=""><br>weight为权重，权重越大越优先分配请求<br>继续编辑<br><img src="https://github.com/ayanamiq/images/blob/master/images/nginx_conf2.png?raw=true" alt=""><br>proxy_pass配置是 为<a href="http://locahost" target="_blank" rel="noopener">http://locahost</a> 开启代理服务，如网站上线则换成网址<br>配置完之后，重启nginx<br>打开浏览器，输入locahost 则可看到两个tomcat互换的效果，证明配置成功<br>(ps:老毛子真的屌)</p>
<h3 id="6-静态资源分离"><a href="#6-静态资源分离" class="headerlink" title="6.静态资源分离"></a>6.静态资源分离</h3><p>静态资源为 css ,js,html,图片等资源<br>编辑conf/nginx.conf<br><img src="https://github.com/ayanamiq/images/blob/master/images/nginx_conf3.png?raw=true" alt=""><br>此段配置为 当访问.jpg或.png时，会到D：/upload去匹配资源<br>要保证路径在本机存在<br>配置完成后，重启nginx<br>到该路径下放置一张图片<br>打开浏览器，输入localhost/文件名，可以访问到该图片证明配置成功<br><img src="https://github.com/ayanamiq/images/blob/master/images/nginx_img.png?raw=true" alt=""><br>该配置可匹配多层路径，如在upload文件夹下创建一个新的文件夹images并放置一张图片<br>打开浏览器输入localhost/images/文件名  则可加载images文件夹下对应名字的图片</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/12/06/MarkDown语法/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="王靖尧">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="王靖尧的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/06/MarkDown语法/" itemprop="url">MarkDown语法</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-12-06T14:48:51+08:00">
                2018-12-06
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="标题"><a href="#标题" class="headerlink" title="标题"></a>标题</h2><p>总共六级标题，建议在井号后加一个空格，这是最标准的 Markdown 语法。</p>
<h1 id="一级标题"><a href="#一级标题" class="headerlink" title="一级标题"></a>一级标题</h1><h2 id="二级标题"><a href="#二级标题" class="headerlink" title="二级标题"></a>二级标题</h2><h3 id="三级标题"><a href="#三级标题" class="headerlink" title="三级标题"></a>三级标题</h3><h4 id="四级标题"><a href="#四级标题" class="headerlink" title="四级标题"></a>四级标题</h4><h5 id="五级标题"><a href="#五级标题" class="headerlink" title="五级标题"></a>五级标题</h5><h6 id="六级标题"><a href="#六级标题" class="headerlink" title="六级标题"></a>六级标题</h6><p>和h1到h6一样，字体由大到小</p>
<p><strong>换行</strong><br>换行：只需在行末加两个空格键和一个回车键即可换行<br><strong>分段</strong><br>分段：段落之间空一行即可。</p>
<h2 id="文本样式"><a href="#文本样式" class="headerlink" title="文本样式"></a>文本样式</h2><p><strong>加粗</strong><br>字体两边各加两个星号 <strong> 快捷键 ctrl+b（编辑器的右上角有写奥）
</strong>斜体<strong><br>字体两边各加  __ 快捷键 ctrl+i
</strong>删除线**<br>各加两个波浪线。  快捷键：ctrl+u ,和uc浏览器有热键冲突<br><img src="/2018/12/06/MarkDown语法/1.png" alt="文本样式"></p>
<h2 id="列表"><a href="#列表" class="headerlink" title="列表"></a>列表</h2><p><strong>无序列表</strong><br>直接在文字前加「 - 」(减号) 或者 「 <em> 」 即可<br>在 「 </em> 」 前加两个空格键或者一个 tab 键就可以产生一个子列表。<br><strong>有序列表</strong><br>在文本前加 「字母.」 或 「数字.」 即可生成一个有序列表。<br>注意，当你第一个序号使用什么作为标记的，那么同级别的列表就会自动使用其作为标记。<br><img src="/2018/12/06/MarkDown语法/2.png" alt=""></p>
<h2 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h2><p>文本前加大于号  &gt;  即可<br><img src="/2018/12/06/MarkDown语法/3.png" alt=""></p>
<h2 id="图片和连接"><a href="#图片和连接" class="headerlink" title="图片和连接"></a>图片和连接</h2><p><strong>图片</strong><br><img src="/2018/12/06/MarkDown语法/连接地址" alt="图片描述">：感叹号+中括号[图片描述]+小括号(连接地址)<br><strong>连接</strong><br><a href="连接地址">文本内容</a>：中括号+小括号<br>图文比连接多一个感叹号<br><img src="/2018/12/06/MarkDown语法/4.png" alt=""></p>
<p>注:如果引用网络图片会出现连接失效的问题…<br>方法1：将图片上传到新浪图床<br>方法2:直接把图上传到github上<br>具体做法就是：建一个专门用来存图片的github仓库，然后把图片传上来，用github的内存</p>
<h2 id="水平线"><a href="#水平线" class="headerlink" title="水平线"></a>水平线</h2><h2 id="三个减号—-或者桑和星号-都可以画出一条水平分割线"><a href="#三个减号—-或者桑和星号-都可以画出一条水平分割线" class="headerlink" title="三个减号— 或者桑和星号***都可以画出一条水平分割线"></a>三个减号— 或者桑和星号***都可以画出一条水平分割线</h2><h2 id="代码框"><a href="#代码框" class="headerlink" title="代码框"></a>代码框</h2><p><code>第一段代码，这两个符号如何用键盘打出来？</code> </p>
<h2 id="表格"><a href="#表格" class="headerlink" title="表格"></a>表格</h2><p>在 Markdown 下制作表格，是非常非常麻烦的一件事——你必须画出来！<br><img src="/2018/12/06/MarkDown语法/5.png" alt=""><br>我这么懒，肯定不会画的…</p>
<h2 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h2><p>和html里的注释是一样滴<br>注释是给自己看的，预览时也不会出现，当然发布出去别人也不会看见。<br><!-- 一段注释 --></p>
<h2 id="首行缩进"><a href="#首行缩进" class="headerlink" title="首行缩进"></a>首行缩进</h2><p>  两个空格<br>空格好像不太对…</p>
<h2 id="制表"><a href="#制表" class="headerlink" title="制表"></a>制表</h2><p>记录一种最简单的制表方法</p>
<table>
<thead>
<tr>
<th>title1</th>
<th>title1</th>
</tr>
</thead>
<tbody>
<tr>
<td>content1</td>
<td>content2</td>
</tr>
<tr>
<td>content3</td>
<td>content4</td>
</tr>
<tr>
<td>content5</td>
<td>content6</td>
</tr>
</tbody>
</table>
<p>表头必须和浅表的内容间隔一行，表头和内容之间由<br>– | –<br>分隔，一个 – 表示一个表头，中间由竖线分隔，不需要加空格。如果表头有四个，<br>– | – | – | –<br>这样就可以了。</p>
<h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/12/05/Hexo博客搭建/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="王靖尧">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="王靖尧的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/05/Hexo博客搭建/" itemprop="url">Hexo博客搭建</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-12-05T13:54:31+08:00">
                2018-12-05
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/建站/" itemprop="url" rel="index">
                    <span itemprop="name">建站</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>总体步骤：<br>1.安装Git Bash<br>2.安装NodeJs<br>3.安装hexo<br>4.生成SSH并添加到github<br>5.部署项目<br>6.上传到github<br>7.绑定个人域名<br>8.修改及配置主题<br>9.添加RSS<br>10.添加评论<br>11.写文章部分<br>安装git、node.js，创建github账号-创建仓库userName.github.io-将本地git通过ssh和远程github关联等等不再赘述。</p>
<h2 id="1-安装Hexo"><a href="#1-安装Hexo" class="headerlink" title="1.安装Hexo"></a>1.安装Hexo</h2><p>Hexo官网地址：<br><a href="https://hexo.io/zh-cn/docs/" target="_blank" rel="noopener">https://hexo.io/zh-cn/docs/</a></p>
<p>在git和node安装完毕后，即可使用 npm 安装 Hexo<br><code>$ npm install -g hexo-cli</code></p>
<p>安装完之后，初始化Hexo<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hexo init &lt;folder&gt;</span><br><span class="line">cd &lt;folder&gt;</span><br><span class="line">npm install</span><br></pre></td></tr></table></figure></p>
<p>上边官网给出的指令，这里就比较坑逼了。因为不知道里填什么，实际应该是：你想安装Hexo博客文件的文件夹的路径。<br>所以建议使用git bush cd 到想存放博客文件的父目录，然后直接使用<br><code>hexo init 文件夹名</code><br>指令，就完成初始化了。</p>
<p>遇到的坑：<br>因为刚开始文件夹的名字写错了，所以直接将hexo初始化的文件夹删掉了。然后再次运行初始化指令报错。解决方法：<br><img src="/2018/12/05/Hexo博客搭建/1.png" alt=""></p>
<h2 id="2-修改配置文件"><a href="#2-修改配置文件" class="headerlink" title="2.修改配置文件"></a>2.修改配置文件</h2><p>用Notepad++打开hexo安装目录下的_config.yml文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">deploy:</span><br><span class="line">  type: git</span><br><span class="line">  repo: https://github.com/ayanamiq/ayanamiq.github.io</span><br><span class="line">  branch: master</span><br></pre></td></tr></table></figure></p>
<p>修改上面三项内容，repo和branch是没有的，写上就好了。<br>坑：<br>1.repo是在github上创建好的仓库地址，仓库名字必须是username.github.io<br>2.key和后面value之间必须有空格。</p>
<p>然后执行如下命令<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hexo clean</span><br><span class="line">hexo generate</span><br><span class="line">hexo server</span><br></pre></td></tr></table></figure></p>
<p>注：hexo 3.0把服务器独立成个别模块，需要单独安装：<br><code>npm i hexo-server</code><br>然后打开<br><a href="http://localhost:4000" target="_blank" rel="noopener">http://localhost:4000</a><br>就可以看到hexo的默认页面了<br>注：关闭页面服务就会停止</p>
<h2 id="3-上传到github"><a href="#3-上传到github" class="headerlink" title="3.上传到github"></a>3.上传到github</h2><p>先安装：<br><code>npm install hexo-deployer-git --save</code><br>这样才能将你写好的文章部署到github服务器上并让别人浏览到。</p>
<p>执行命令<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hexo clean</span><br><span class="line">hexo generate</span><br><span class="line">hexo deploy</span><br></pre></td></tr></table></figure></p>
<p>如果执行第一个指令就报：<br><code>Usage: hexo &lt;command&gt;</code><br>原因：我认为是没有生成本地服务<br>解决：执行指令<br><code>$ npm install hexo-server --save</code><br>还是不行…为啥呢？<br>因为指令必须在hexo的安装目录下执行！！！</p>
<p>注意deploy的过程中要输入你github的username和password<br>然后打开：<br><a href="https://ayanamiq.github.io/" target="_blank" rel="noopener">https://ayanamiq.github.io/</a><br>就可以看到刚才在本地一样访问<br><a href="http://localhost:4000" target="_blank" rel="noopener">http://localhost:4000</a><br>一样的页面了</p>
<p>坑：这里在deploy的时候报错了。<br><code>HttpRequestException encountered</code><br>问题：Github 禁用了TLS v1.0 and v1.1，必须更新Windows的git凭证管理器<br><a href="https://github.com/Microsoft/Git-Credential-Manager-for-Windows/releases/" target="_blank" rel="noopener">https://github.com/Microsoft/Git-Credential-Manager-for-Windows/releases/</a><br>下载并安装第一个GCMW-1.18.3.exe文件(请注意版本迭代)。<br>然后再deploy就可以了。</p>
<h2 id="4-修改及配置主题"><a href="#4-修改及配置主题" class="headerlink" title="4.修改及配置主题"></a>4.修改及配置主题</h2><p>官方主题地址：<br><a href="https://hexo.io/themes/" target="_blank" rel="noopener">https://hexo.io/themes/</a></p>
<p>我使用的是：next<br><a href="http://theme-next.iissnan.com/" target="_blank" rel="noopener">http://theme-next.iissnan.com/</a><br>官网说的非常简单明了，请自行参考。</p>
<h2 id="5-写文章"><a href="#5-写文章" class="headerlink" title="5.写文章"></a>5.写文章</h2><p><code>hexo new &#39;blogName&#39;</code></p>
<p>其他指令参考官网：<br><a href="https://hexo.io/zh-cn/docs/writing" target="_blank" rel="noopener">https://hexo.io/zh-cn/docs/writing</a></p>
<p>然后可以在’source/_posts’下看到新建的文章了，生成的是.md文件，推荐使用markdown编译器。<br>markdown编译器有一堆，比较有名的是markdownPad，但是我懒，还是直接用nodePad++好了。</p>
<p>1.安装MarkdownViewer++<br>因为7.5版本之后无论64还是32位的nodePad++都不再提供plugin manager，所以需要自行安装。<br><a href="https://github.com/bruderstein/nppPluginManager/releases" target="_blank" rel="noopener">https://github.com/bruderstein/nppPluginManager/releases</a><br>下载对应自己nodePad版本的安装包，解压后得到两个文件夹，plugins和updater，<br>分别将文件夹中的文件粘贴到nodePad++安装路径下的plugins和updater文件夹下，<br>然后重启nodePad，就会在插件一栏的下面看到plugin manager，打开，找到MarkdownViewer++，<br>选择右下角的install，安装完之后根据提示重启。</p>
<p>2.导入自定义语言格式<br>为了设置符合markdown语言的显示效果，需要下载Markdown语言格式的xml配置文件<br><a href="https://github.com/Edditoria/markdown-plus-plus" target="_blank" rel="noopener">https://github.com/Edditoria/markdown-plus-plus</a><br>下载之后解压缩，然后打开nodePad，选择语言-&gt;自定义语言格式-&gt;导入-&gt;选择到刚才解压的文件夹的四个theme文件夹中的任意一个，<br>建议选择default，因为nodePad默认就是白底的，其他几个太扎眼。</p>
<h2 id="6-添加“分类”选项"><a href="#6-添加“分类”选项" class="headerlink" title="6.添加“分类”选项"></a>6.添加“分类”选项</h2><p>进入博客所在文件夹，打开gitbush,执行命令<br><code>$ hexo new page categories</code><br>成功后会提示：<br><code>INFO Created: ~/Documents/blog/source/categories/index.md</code></p>
<p>根据上面的路径，找到index.md这个文件，打开后默认内容是这样的：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title: 文章分类</span><br><span class="line">date: 2017-05-27 13:47:40</span><br><span class="line">---</span><br></pre></td></tr></table></figure></p>
<p>添加type: “categories”到内容中，添加后是这样的：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title: 文章分类</span><br><span class="line">date: 2019-05-27 13:47:40</span><br><span class="line">type: &quot;categories&quot;</span><br><span class="line">---</span><br></pre></td></tr></table></figure></p>
<h3 id="给文章添加“categories”属性"><a href="#给文章添加“categories”属性" class="headerlink" title="给文章添加“categories”属性"></a>给文章添加“categories”属性</h3><p>打开需要添加分类的文章，为其添加categories属性。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title: java基础</span><br><span class="line">date: 2018-12-31 12:12:57</span><br><span class="line">categories: - java</span><br><span class="line">---</span><br></pre></td></tr></table></figure></p>
<p>注意：hexo一篇文章只能属于一个分类<br>至此，成功给文章添加分类，点击首页的“分类”可以看到该分类下的所有文章。<br>当然，只有添加了categories: xxx的文章才会被收录到首页的“分类”中。</p>
<h2 id="创建“标签”选项"><a href="#创建“标签”选项" class="headerlink" title="创建“标签”选项"></a>创建“标签”选项</h2><p>进入博客所在文件夹，打开gitbush,执行命令<br><code>$ hexo new page tags</code><br>成功后会提示：<br><code>INFO Created: ~/Documents/blog/source/tags/index.md</code><br>根据上面的路径，找到index.md这个文件，打开后默认内容是这样的：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title: 标签</span><br><span class="line">date: 2017-05-27 14:22:08</span><br><span class="line">---</span><br></pre></td></tr></table></figure></p>
<p>添加type: “tags”到内容中，添加后是这样的：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title: 文章分类</span><br><span class="line">date: 2017-05-27 13:47:40</span><br><span class="line">type: &quot;tags&quot;</span><br><span class="line">---</span><br></pre></td></tr></table></figure></p>
<p>保存并关闭文件。</p>
<h3 id="给文章添加“tags”属性"><a href="#给文章添加“tags”属性" class="headerlink" title="给文章添加“tags”属性"></a>给文章添加“tags”属性</h3><p>打开需要添加标签的文章，为其添加tags属性。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title: java基础</span><br><span class="line">date: 2017-05-26 12:12:57</span><br><span class="line">categories: </span><br><span class="line">- java基础</span><br><span class="line">tags:</span><br><span class="line">- java</span><br><span class="line">- 基础</span><br><span class="line">---</span><br></pre></td></tr></table></figure></p>
<p>至此，成功给文章添加分类，点击首页的“标签”可以看到该标签下的所有文章。<br>当然，只有添加了tags: xxx的文章才会被收录到首页的“标签”中。</p>
<p>细心的朋友可能已经发现，这两个的设置几乎一模一样！是的，没错，思路都是一样的。<br>所以我们可以打开scaffolds/post.md文件，在tages:上面加入categories:,<br>保存后，之后执行hexo new 文章名命令生成的文件，页面里就有categories:项了。</p>
<p>scaffolds目录下，是新建页面的模板，执行新建命令时，是根据这里的模板页来完成的，所以可以在这里根据你自己的需求添加一些默认值。</p>
<h2 id="添加about标签"><a href="#添加about标签" class="headerlink" title="添加about标签"></a>添加about标签</h2><p><code>hexo new page &#39;about&#39;</code><br>在安装位置下的source文件夹下会有about文件夹，打开，编辑里面的index.md</p>
<h2 id="引用图片"><a href="#引用图片" class="headerlink" title="引用图片"></a>引用图片</h2><p>总体来说有两种引用方式：<br>1.公网图片地址<br>2.将图片引入项目内，使用相对路径</p>
<p>公网地址总是不可靠的，又没有自己的服务器，只能传到别的地方，这样链接总有可能会失效。<br>可行的办法：<br>1.把图片上传到新浪图床<br>2.在github新建一个res，专门用来存放图片。</p>
<p>将图片引入项目内<br>1.修改项目的_config.yml，post_asset_folder:true<br>Hexo 提供了一种更方便管理 Asset 的设定：post_asset_folder<br>当您设置post_asset_folder为true参数后，在建立文件时，Hexo会自动建立一个与文章同名的文件夹，您可以把与该文章相关的所有资源都放到那个文件夹，如此一来，您便可以更方便的使用资源。</p>
<p>2.在hexo的目录下执行<br><code>npm install https://github.com/CodeFalling/hexo-asset-image --save</code><br>需要等待一段时间</p>
<p>3.完成安装后用hexo新建文章的时候会发现_posts目录下面会多出一个和文章名字一样的文件夹。图片就可以放在文件夹下面。结构如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">本地图片测试</span><br><span class="line">├── apppicker.jpg</span><br><span class="line">├── logo.jpg</span><br><span class="line">└── rules.jpg</span><br><span class="line">本地图片测试.md</span><br></pre></td></tr></table></figure></p>
<p>这样的目录结构（目录名和文章名一致），只要使用 <img src="/2018/12/05/Hexo博客搭建/本地图片测试/logo.jpg" alt="logo"> 就可以插入图片。<br>生成的结构为<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">public/2016/3/9/本地图片测试</span><br><span class="line">├── apppicker.jpg</span><br><span class="line">├── index.html</span><br><span class="line">├── logo.jpg</span><br><span class="line">└── rules.jpg</span><br></pre></td></tr></table></figure></p>
<p>同时，生成的 html 是<br><code>&lt;img src=&quot;/2016/3/9/本地图片测试/logo.jpg&quot; alt=&quot;logo&quot;&gt;</code></p>
<p>而不是愚蠢的<br><code>&lt;img src=&quot;本地图片测试/logo.jpg&quot; alt=&quot;logo&quot;&gt;</code></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">王靖尧</p>
              <p class="site-description motion-element" itemprop="description">一晃而过的时间，都做了些什么</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">17</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">1</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">12</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-snowflake-o"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">王靖尧</span>

  
</div>









        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
